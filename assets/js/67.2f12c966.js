(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{178:function(e,a,s){"use strict";s.r(a);var r=s(0),t=Object(r.a)({},function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"zookeeper不断提示连接被拒绝问题解决"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper不断提示连接被拒绝问题解决","aria-hidden":"true"}},[e._v("#")]),e._v(" Zookeeper不断提示连接被拒绝问题解决")]),e._v(" "),s("h2",{attrs:{id:"问题描述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题描述","aria-hidden":"true"}},[e._v("#")]),e._v(" 问题描述")]),e._v(" "),s("p",[e._v("zookeeper启动后,查看zookeeper.out文件提示连接被拒，每次都是秒断，日志不断刷新。")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("2019-03-20 18:50:36,190 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("myid:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" - INFO  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxnFactory@197"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" - Accepted socket connection from /127.0.0.1:45886\n2019-03-20 18:50:36,191 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("myid:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" - INFO  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:ZooKeeperServer@812"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" - Refusing session request "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" client /127.0.0.1:45886 as it has seen zxid 0x9 our last zxid is 0x0 client\n must try another server\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("h2",{attrs:{id:"软件版本和环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#软件版本和环境","aria-hidden":"true"}},[e._v("#")]),e._v(" 软件版本和环境")]),e._v(" "),s("ul",[s("li",[e._v("jdk:1.8")]),e._v(" "),s("li",[e._v("zookeeper:3.4.5")]),e._v(" "),s("li",[e._v("dobbo:2.5.8\n其中zookeeper为单节点。")])]),e._v(" "),s("h2",{attrs:{id:"原因分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原因分析","aria-hidden":"true"}},[e._v("#")]),e._v(" 原因分析")]),e._v(" "),s("p",[e._v("由于新起的zk拥有比其他server大的zxid，会被认为是最新的内容。但集群策略不允许新加入的server拥有最新的内容。所以一直踢掉该连接。删除dataDir目录会导致这个问题。")]),e._v(" "),s("h2",{attrs:{id:"问题重现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题重现","aria-hidden":"true"}},[e._v("#")]),e._v(" 问题重现")]),e._v(" "),s("ul",[s("li",[e._v("启动zookeeper")])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("sh bin/zkServer.sh start\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("让一个应用连接到zookeeper，这里使用dubbo-monitor作为测试应用，可以从dubbo中下载")])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("sh bin/start.sh\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("关闭zookeeper")])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("sh bin/zkServer.sh stop\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("删除zookeeper目录,该目录在zoo.cfg中配置的dataDir，该目录存在了zookeeper的数据。")]),e._v(" "),s("li",[e._v("重新启动zookeeper")]),e._v(" "),s("li",[e._v("查看日志，发现日志出现问题描述中的提示。")])]),e._v(" "),s("h2",{attrs:{id:"问题解决"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题解决","aria-hidden":"true"}},[e._v("#")]),e._v(" 问题解决")]),e._v(" "),s("p",[e._v("重启zookeeper后，重启所有连接到zookeeper中的所有java应用。")]),e._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[e._v("#")]),e._v(" 总结")]),e._v(" "),s("p",[e._v("通过问题重现以及zookeeper的配置文件，发现dataDir目录使用的是默认的目录:/tmp/zookeeper，这个目录可能在重启后被删除，导致在重启zookeeper后出现上述问题。")]),e._v(" "),s("p",[e._v("该问题更加详细的描述可以参考："),s("a",{attrs:{href:"https://issues.apache.org/jira/browse/ZOOKEEPER-832",target:"_blank",rel:"noopener noreferrer"}},[e._v("ZOOKEEPER-832"),s("OutboundLink")],1)]),e._v(" "),s("Valine")],1)},[],!1,null,null,null);a.default=t.exports}}]);