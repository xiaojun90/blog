(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{176:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"log4j配置无效的解决方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#log4j配置无效的解决方法","aria-hidden":"true"}},[s._v("#")]),s._v(" log4j配置无效的解决方法")]),s._v(" "),t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),t("p",[s._v("在项目中配置了log4j不起作用，但仍然可以输日志，猜想是不是在其它地方配置了log4j。")]),s._v(" "),t("h2",{attrs:{id:"解决方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决方法","aria-hidden":"true"}},[s._v("#")]),s._v(" 解决方法")]),s._v(" "),t("p",[s._v("如何去确认是否是使用其它地方的log4j配置呢？\n可以在java命令中加入-Dlog4j.debug虚拟机参数来显示log4j加载配置文件的位置。")]),s._v(" "),t("p",[s._v("打印结果显示：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("log4j: Trying to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("log4j.xml"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" using context classloader sun.misc.Launcher"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$AppClassLoader@18b4aac2")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v(".")]),s._v("\nlog4j: Trying to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("log4j.xml"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" using sun.misc.Launcher"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$AppClassLoader@18b4aac2")]),s._v(" class loader.\nlog4j: Trying to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("log4j.xml"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" using ClassLoader.getSystemResource"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\nlog4j: Trying to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("log4j.properties"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" using context classloader sun.misc.Launcher"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$AppClassLoader@18b4aac2")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v(".")]),s._v("\nlog4j: Using URL "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("jar:file:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/hisuConnPoolAPI20160105.jar"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("/log4j.properties"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" automatic log4j configuration.\nlog4j: Reading configuration from URL jar:file:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/lib/hisuConnPoolAPI20160105.jar"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("/log4j.properties\nlog4j: Parsing "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" with value"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("debug,stdout,file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".\nlog4j: Level token is "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("debug"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("从中可以很明显加载了第三方jar包的log4j.properties文件。")]),s._v(" "),t("h2",{attrs:{id:"扩展"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#扩展","aria-hidden":"true"}},[s._v("#")]),s._v(" 扩展")]),s._v(" "),t("p",[s._v("此时，如果我们在自己定义一个log4j.properties的文件，看会加载哪个配置文件呢？")]),s._v(" "),t("p",[s._v("此时打印的内容显示：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("log4j: Trying to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("log4j.xml"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" using context classloader sun.misc.Launcher"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$AppClassLoader@18b4aac2")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v(".")]),s._v("\nlog4j: Trying to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("log4j.xml"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" using sun.misc.Launcher"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$AppClassLoader@18b4aac2")]),s._v(" class loader.\nlog4j: Trying to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("log4j.xml"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" using ClassLoader.getSystemResource"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\nlog4j: Trying to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("log4j.properties"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" using context classloader sun.misc.Launcher"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$AppClassLoader@18b4aac2")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v(".")]),s._v("\nlog4j: Using URL "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("file:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/target/classes/log4j.properties"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" automatic log4j configuration.\nlog4j: Reading configuration from URL file:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/target/classes/log4j.properties\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("发现找到的是刚才自定义的日志文件。")]),s._v(" "),t("h2",{attrs:{id:"相关源码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#相关源码","aria-hidden":"true"}},[s._v("#")]),s._v(" 相关源码")]),s._v(" "),t("p",[s._v("加载配置文件部分的源码")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//LoggerManager.java")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" DEFAULT_CONFIGURATION_FILE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"log4j.properties"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" DEFAULT_XML_CONFIGURATION_FILE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"log4j.xml"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 下面是一个静态代码块，可以看到先找classpath下的log4j.xml文件，如果找不到就找classpath下的log4j.properties。loader.getResource找到一条就会结束。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("configurationOptionStr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\t\n\turl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Loader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getResource")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("DEFAULT_XML_CONFIGURATION_FILE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t  url "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Loader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getResource")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("DEFAULT_CONFIGURATION_FILE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("Valine")],1)},[],!1,null,null,null);a.default=e.exports}}]);