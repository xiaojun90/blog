<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用umi完成用户管理的crud | Joyxj</title>
    <meta name="description" content="该博客已停止更新，请访问: https://joyxj.com">
    <link rel="icon" href="/blog/logo.ico">
    
    <link rel="preload" href="/blog/assets/css/0.styles.69658b2c.css" as="style"><link rel="preload" href="/blog/assets/js/app.031b747b.js" as="script"><link rel="preload" href="/blog/assets/js/2.48c166e5.js" as="script"><link rel="preload" href="/blog/assets/js/5.67f4c3de.js" as="script"><link rel="preload" href="/blog/assets/js/11.e98dd118.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.36b2f03d.js"><link rel="prefetch" href="/blog/assets/js/12.ed06b578.js"><link rel="prefetch" href="/blog/assets/js/13.3c5fe50c.js"><link rel="prefetch" href="/blog/assets/js/14.9b523fd3.js"><link rel="prefetch" href="/blog/assets/js/15.7a030138.js"><link rel="prefetch" href="/blog/assets/js/16.f7bc28ad.js"><link rel="prefetch" href="/blog/assets/js/17.34ecfbef.js"><link rel="prefetch" href="/blog/assets/js/18.eb354e34.js"><link rel="prefetch" href="/blog/assets/js/19.621fe99c.js"><link rel="prefetch" href="/blog/assets/js/20.bf4d4124.js"><link rel="prefetch" href="/blog/assets/js/21.3def2c0b.js"><link rel="prefetch" href="/blog/assets/js/22.3f045030.js"><link rel="prefetch" href="/blog/assets/js/23.f8cd15c0.js"><link rel="prefetch" href="/blog/assets/js/24.4ea57df2.js"><link rel="prefetch" href="/blog/assets/js/25.2b941ebf.js"><link rel="prefetch" href="/blog/assets/js/26.46dcab34.js"><link rel="prefetch" href="/blog/assets/js/27.245c465b.js"><link rel="prefetch" href="/blog/assets/js/28.5d8470c5.js"><link rel="prefetch" href="/blog/assets/js/29.9473b7ec.js"><link rel="prefetch" href="/blog/assets/js/3.66aaf88e.js"><link rel="prefetch" href="/blog/assets/js/30.709d6fe6.js"><link rel="prefetch" href="/blog/assets/js/31.58e5919f.js"><link rel="prefetch" href="/blog/assets/js/32.ce4f47ba.js"><link rel="prefetch" href="/blog/assets/js/33.cc99d717.js"><link rel="prefetch" href="/blog/assets/js/34.1f91e004.js"><link rel="prefetch" href="/blog/assets/js/35.3571cfbb.js"><link rel="prefetch" href="/blog/assets/js/36.6a97d6da.js"><link rel="prefetch" href="/blog/assets/js/37.0e5b8fda.js"><link rel="prefetch" href="/blog/assets/js/38.72abbcf5.js"><link rel="prefetch" href="/blog/assets/js/39.f81d974a.js"><link rel="prefetch" href="/blog/assets/js/4.1d298d49.js"><link rel="prefetch" href="/blog/assets/js/40.5675edb6.js"><link rel="prefetch" href="/blog/assets/js/41.06aebbc7.js"><link rel="prefetch" href="/blog/assets/js/42.ec085821.js"><link rel="prefetch" href="/blog/assets/js/43.ed4c8939.js"><link rel="prefetch" href="/blog/assets/js/44.74124250.js"><link rel="prefetch" href="/blog/assets/js/45.06667515.js"><link rel="prefetch" href="/blog/assets/js/46.99c326fb.js"><link rel="prefetch" href="/blog/assets/js/47.3968849a.js"><link rel="prefetch" href="/blog/assets/js/48.55ab51fa.js"><link rel="prefetch" href="/blog/assets/js/49.0b6372b7.js"><link rel="prefetch" href="/blog/assets/js/50.c95f8843.js"><link rel="prefetch" href="/blog/assets/js/51.6e630485.js"><link rel="prefetch" href="/blog/assets/js/52.de8d77e2.js"><link rel="prefetch" href="/blog/assets/js/53.ea5fe844.js"><link rel="prefetch" href="/blog/assets/js/54.c3094c4c.js"><link rel="prefetch" href="/blog/assets/js/55.fb84ca60.js"><link rel="prefetch" href="/blog/assets/js/56.6db06f77.js"><link rel="prefetch" href="/blog/assets/js/57.6713b160.js"><link rel="prefetch" href="/blog/assets/js/58.dd36f215.js"><link rel="prefetch" href="/blog/assets/js/59.99a80f4a.js"><link rel="prefetch" href="/blog/assets/js/6.0776e1fb.js"><link rel="prefetch" href="/blog/assets/js/60.92997268.js"><link rel="prefetch" href="/blog/assets/js/61.8532934c.js"><link rel="prefetch" href="/blog/assets/js/62.40139a10.js"><link rel="prefetch" href="/blog/assets/js/63.1829e1df.js"><link rel="prefetch" href="/blog/assets/js/64.d3cc70ac.js"><link rel="prefetch" href="/blog/assets/js/65.73484530.js"><link rel="prefetch" href="/blog/assets/js/66.e11b16f6.js"><link rel="prefetch" href="/blog/assets/js/67.2f12c966.js"><link rel="prefetch" href="/blog/assets/js/68.6cf8f9cb.js"><link rel="prefetch" href="/blog/assets/js/69.d5627070.js"><link rel="prefetch" href="/blog/assets/js/7.3267807a.js"><link rel="prefetch" href="/blog/assets/js/70.2ad3f243.js"><link rel="prefetch" href="/blog/assets/js/71.2f68f886.js"><link rel="prefetch" href="/blog/assets/js/72.0152b066.js"><link rel="prefetch" href="/blog/assets/js/73.41ee1205.js"><link rel="prefetch" href="/blog/assets/js/74.920d4bc9.js"><link rel="prefetch" href="/blog/assets/js/75.b2d6c93b.js"><link rel="prefetch" href="/blog/assets/js/76.e66a8d5e.js"><link rel="prefetch" href="/blog/assets/js/77.ca4251c6.js"><link rel="prefetch" href="/blog/assets/js/78.9bb35162.js"><link rel="prefetch" href="/blog/assets/js/79.d82d8484.js"><link rel="prefetch" href="/blog/assets/js/8.0ddd2ef5.js"><link rel="prefetch" href="/blog/assets/js/80.80c1f257.js"><link rel="prefetch" href="/blog/assets/js/81.6b8d938a.js"><link rel="prefetch" href="/blog/assets/js/82.6d3d9bc9.js"><link rel="prefetch" href="/blog/assets/js/83.c6466837.js"><link rel="prefetch" href="/blog/assets/js/84.b5d49150.js"><link rel="prefetch" href="/blog/assets/js/85.0983c45a.js"><link rel="prefetch" href="/blog/assets/js/86.9c6c1ddc.js"><link rel="prefetch" href="/blog/assets/js/87.c17f7096.js"><link rel="prefetch" href="/blog/assets/js/88.dfbd699a.js"><link rel="prefetch" href="/blog/assets/js/89.7fa011ad.js"><link rel="prefetch" href="/blog/assets/js/9.434ce666.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.69658b2c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Joyxj</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/architecture/" class="nav-link">架构设计</a></div><div class="nav-item"><a href="/blog/frontend/4001.html" class="nav-link">前端</a></div><div class="nav-item"><a href="/blog/backend/2001.html" class="nav-link">后端</a></div><div class="nav-item"><a href="/blog/bigdata.html" class="nav-link">大数据</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">系列教程</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/series/netty/" class="nav-link">Netty系列</a></li><li class="dropdown-item"><!----> <a href="/blog/series/dubbo/" class="nav-link">Dubbo系列</a></li></ul></div></div><div class="nav-item"><a href="/blog/other/5001.html" class="nav-link">杂记</a></div><div class="nav-item"><a href="https://github.com/xiaojun90/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/architecture/" class="nav-link">架构设计</a></div><div class="nav-item"><a href="/blog/frontend/4001.html" class="nav-link">前端</a></div><div class="nav-item"><a href="/blog/backend/2001.html" class="nav-link">后端</a></div><div class="nav-item"><a href="/blog/bigdata.html" class="nav-link">大数据</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">系列教程</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/series/netty/" class="nav-link">Netty系列</a></li><li class="dropdown-item"><!----> <a href="/blog/series/dubbo/" class="nav-link">Dubbo系列</a></li></ul></div></div><div class="nav-item"><a href="/blog/other/5001.html" class="nav-link">杂记</a></div><div class="nav-item"><a href="https://github.com/xiaojun90/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/frontend/4001.html" class="sidebar-link">CSS样式重置</a></li><li><a href="/blog/frontend/4003.html" class="active sidebar-link">使用umi完成用户管理的crud</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frontend/4003.html#_1-安装yarn和tyarn" class="sidebar-link">1.安装yarn和tyarn</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/4003.html#_2-脚手架创建应用" class="sidebar-link">2.脚手架创建应用</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/4003.html#_3-生成users路由" class="sidebar-link">3.生成users路由</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/4003.html#_4-umi整合dva" class="sidebar-link">4.umi整合dva</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/4003.html#_5-配置代理" class="sidebar-link">5.配置代理</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/4003.html#_6-构造users-model和service" class="sidebar-link">6.构造users model和service</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/4003.html#_7-添加页面，显示用户列表" class="sidebar-link">7.添加页面，显示用户列表</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/4003.html#_8-添加layout" class="sidebar-link">8.添加layout</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/4003.html#_9-处理-loading-状态" class="sidebar-link">9.处理 loading 状态</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/4003.html#_10-处理用户删除" class="sidebar-link">10. 处理用户删除</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/4003.html#_11-用户修改" class="sidebar-link">11. 用户修改</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/4003.html#_12-用户创建" class="sidebar-link">12.用户创建</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/4003.html#_13-最后效果图" class="sidebar-link">13.最后效果图</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用umi完成用户管理的crud"><a href="#使用umi完成用户管理的crud" aria-hidden="true" class="header-anchor">#</a> 使用umi完成用户管理的crud</h1> <h2 id="_1-安装yarn和tyarn"><a href="#_1-安装yarn和tyarn" aria-hidden="true" class="header-anchor">#</a> 1.安装yarn和tyarn</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 国内源</span>
$ <span class="token function">npm</span> i <span class="token function">yarn</span> tyarn -g
<span class="token comment"># 后面文档里的 yarn 换成 tyarn</span>
$ tyarn -v
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_2-脚手架创建应用"><a href="#_2-脚手架创建应用" aria-hidden="true" class="header-anchor">#</a> 2.脚手架创建应用</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> user-dashboard
<span class="token function">cd</span> user-dashboard
tyarn create umi
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>选择project-&gt;dva,安装依赖，启动</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>tyarn 
tyarn start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>打开浏览器访问:http://localhost:8000,显示下列页面则表示成功。</p> <p><img src="4003-1.png" alt="Alt 首页"></p> <h2 id="_3-生成users路由"><a href="#_3-生成users路由" aria-hidden="true" class="header-anchor">#</a> 3.生成users路由</h2> <p>umi中文件即路由，所以要新增路由，只要创建文件即可。</p> <p>创建src/pages/users/index.js文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Users pages<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>访问:http://localhost:8000/users,能够正常访问则表示成功。</p> <p><img src="4003-2.png" alt="Alt users page"></p> <h2 id="_4-umi整合dva"><a href="#_4-umi整合dva" aria-hidden="true" class="header-anchor">#</a> 4.umi整合dva</h2> <p>由于使用脚手架创建项目时，已经选择了dva,所以可以不用安装dva。
修改配置文件.umirc.js文件，开启dva。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">'umi-plugin-react'</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        dva<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          immer<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="_5-配置代理"><a href="#_5-配置代理" aria-hidden="true" class="header-anchor">#</a> 5.配置代理</h2> <p>修改.umirc.js文件,增加代理配置</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token string">&quot;proxy&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;/api&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;target&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;http://jsonplaceholder.typicode.com/&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;changeOrigin&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string">&quot;pathRewrite&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;^/api&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>此时访问http://localhost:8000/api/users，可显示用户列表数据。</p> <h2 id="_6-构造users-model和service"><a href="#_6-构造users-model和service" aria-hidden="true" class="header-anchor">#</a> 6.构造users model和service</h2> <p>model分为二种，一种是全局model，一种是页面model。全局 model 存于 /src/models/ 目录，所有页面都可引用；页面 model 不能被其他页面所引用这里使用页面model。</p> <p>新增src/pages/users/models/users.js,内容如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> usersService <span class="token keyword">from</span> <span class="token string">'../services/users'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    namespaces<span class="token punctuation">:</span> <span class="token string">'users'</span><span class="token punctuation">,</span> <span class="token comment">//命名空间</span>
    state<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">//状态数据</span>
        list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        total<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        page<span class="token punctuation">:</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    reducers<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">//处理同步请求，常用于计算state</span>
        <span class="token function">save</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span><span class="token punctuation">{</span>payload<span class="token punctuation">:</span><span class="token punctuation">{</span>data<span class="token punctuation">:</span>list<span class="token punctuation">,</span>total<span class="token punctuation">,</span>page<span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//save为effects中的put中的type</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                page <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span>list<span class="token punctuation">,</span>total<span class="token punctuation">,</span>page<span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    effects<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">//处理异步请求</span>
        <span class="token operator">*</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> payload<span class="token punctuation">:</span> <span class="token punctuation">{</span> page <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> call<span class="token punctuation">,</span> put <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> headers <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>usersService<span class="token punctuation">.</span>fetch<span class="token punctuation">,</span> <span class="token punctuation">{</span> page <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//执行异步的请求，等待返回值</span>
          <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'save'</span><span class="token punctuation">,</span> payload<span class="token punctuation">:</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> total<span class="token punctuation">:</span> headers<span class="token punctuation">[</span><span class="token string">'x-total-count'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>page <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    subscriptions<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">//订阅器</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> history <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> history<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> pathname<span class="token punctuation">,</span> query <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">//监听Url</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname <span class="token operator">===</span> <span class="token string">'/users'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'fetch'</span><span class="token punctuation">,</span> payload<span class="token punctuation">:</span> query <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//payload:请求的参数</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>新增src/pages/users/services/users.js文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'../../../utils/request'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> page <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/api/users?_page=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>page<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;_limit=5`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>新增src/utils/request.js文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> fetch <span class="token keyword">from</span> <span class="token string">'dva/fetch'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">checkStatus</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
  error<span class="token punctuation">.</span>response <span class="token operator">=</span> response<span class="token punctuation">;</span>
  <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Requests a URL, returning a promise.
 *
 * @param  {string} url       The URL we want to request
 * @param  {object} [options] The options we want to pass to &quot;fetch&quot;
 * @return {object}           An object containing either &quot;data&quot; or &quot;err&quot;
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">checkStatus</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> ret <span class="token operator">=</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">,</span>
    headers<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'x-total-count'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ret<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'x-total-count'</span><span class="token punctuation">]</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'x-total-count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>切换到浏览器，虽然页面仍然没有数据，但是打开redux开发工具，应该可以看到 users/fetch 和 users/save 的 action 以及相关的 state。</p> <p><img src="/blog/assets/img/4003-3.526dd2da.png" alt="Alt state数据"></p> <h2 id="_7-添加页面，显示用户列表"><a href="#_7-添加页面，显示用户列表" aria-hidden="true" class="header-anchor">#</a> 7.添加页面，显示用户列表</h2> <p>新建src/pages/users/components/Users.js文件：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Table<span class="token punctuation">,</span> Pagination<span class="token punctuation">,</span> Popconfirm <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> routerRedux <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'dva/router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'dva'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token constant">CURRENT_PAGE</span><span class="token punctuation">,</span><span class="token constant">PAGE_SIZE</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../constants'</span>

<span class="token keyword">class</span> <span class="token class-name">Users</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     
      <span class="token keyword">const</span> <span class="token punctuation">{</span>list<span class="token punctuation">,</span>total<span class="token punctuation">,</span>page<span class="token punctuation">,</span>onChangeHandler<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
      <span class="token keyword">let</span> totalNums <span class="token operator">=</span> Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> current <span class="token operator">=</span> Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>Table dataSource<span class="token operator">=</span><span class="token punctuation">{</span>list<span class="token punctuation">}</span> columns<span class="token operator">=</span><span class="token punctuation">{</span>columns<span class="token punctuation">}</span> rowKey<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">record</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span>record<span class="token punctuation">.</span>id<span class="token punctuation">}</span> pagination<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>Pagination current<span class="token operator">=</span><span class="token punctuation">{</span>current<span class="token punctuation">}</span> defaultCurrent<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">CURRENT_PAGE</span><span class="token punctuation">}</span> total<span class="token operator">=</span><span class="token punctuation">{</span>totalNums<span class="token punctuation">}</span> 
                showTotal<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span> range</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>range<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> of </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>total<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> items`</span></span><span class="token punctuation">}</span>
                defaultPageSize<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">PAGE_SIZE</span><span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;ant-table-pagination&quot;</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChangeHandler<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>                
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
  <span class="token keyword">const</span> columns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">'Name'</span><span class="token punctuation">,</span>
      dataIndex<span class="token punctuation">:</span> <span class="token string">'name'</span><span class="token punctuation">,</span>
      key<span class="token punctuation">:</span> <span class="token string">'name'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token parameter">text</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">'Email'</span><span class="token punctuation">,</span>
      dataIndex<span class="token punctuation">:</span> <span class="token string">'email'</span><span class="token punctuation">,</span>
      key<span class="token punctuation">:</span> <span class="token string">'email'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">'Website'</span><span class="token punctuation">,</span>
      dataIndex<span class="token punctuation">:</span> <span class="token string">'website'</span><span class="token punctuation">,</span>
      key<span class="token punctuation">:</span> <span class="token string">'website'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">'Operation'</span><span class="token punctuation">,</span>
      key<span class="token punctuation">:</span> <span class="token string">'operation'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token operator">&gt;</span>Edit<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Popconfirm title<span class="token operator">=</span><span class="token string">&quot;Confirm to delete?&quot;</span> onConfirm<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">deleteHandler</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token operator">&gt;</span>Delete<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Popconfirm<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">deleteHandler</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`TODO: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span>  <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> list<span class="token punctuation">,</span> total<span class="token punctuation">,</span> page <span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">.</span>users<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      list<span class="token punctuation">,</span>
      total<span class="token punctuation">,</span>
      page<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">onChangeHandler</span><span class="token punctuation">(</span><span class="token parameter">page<span class="token punctuation">,</span> pageSize</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>page <span class="token operator">+</span> <span class="token string">&quot;===&quot;</span> <span class="token operator">+</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span>routerRedux<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        pathname<span class="token punctuation">:</span> <span class="token string">'/users'</span><span class="token punctuation">,</span>
        query<span class="token punctuation">:</span> <span class="token punctuation">{</span> page <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span>mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>Users<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><p>新建一个常量类src/pages/users/constants.js:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">CURRENT_PAGE</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//分页的默认页</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">PAGE_SIZE</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">//分页的默认每页大小</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>此时重新访问http://localhost:8000/users。</p> <p><img src="/blog/assets/img/4003-4.9b4811c2.png" alt="Alt user list"></p> <h2 id="_8-添加layout"><a href="#_8-添加layout" aria-hidden="true" class="header-anchor">#</a> 8.添加layout</h2> <p>umi中约定layouts/index.js为全局路由。</p> <p>新增src/lagyouts/Header.js文件:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Menu<span class="token punctuation">,</span>Icon<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'umi/link'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'./index.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> withRouter <span class="token keyword">from</span> <span class="token string">'umi/withRouter'</span><span class="token punctuation">;</span> <span class="token comment">//使用withRouter,可以使props中包含history,location等信息</span>
<span class="token keyword">class</span> <span class="token class-name">Header</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>header<span class="token punctuation">}</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>Menu mode<span class="token operator">=</span><span class="token string">&quot;horizontal&quot;</span> selectedKeys<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>Menu<span class="token punctuation">.</span>Item key<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;home&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>Home<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>Menu<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>Menu<span class="token punctuation">.</span>Item key<span class="token operator">=</span><span class="token string">&quot;/users&quot;</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">&quot;/users&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>Icon type<span class="token operator">=</span><span class="token string">&quot;bars&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>Users<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>Menu<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>Menu<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withRouter</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>修改src/layouts/index.js</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'./index.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">'./Header'</span>
<span class="token keyword">function</span> <span class="token function">BasicLayout</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>normal<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Header <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span> props<span class="token punctuation">.</span>children <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> BasicLayout<span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>修改src/layouts/index.css</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.header</span> <span class="token punctuation">{</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_9-处理-loading-状态"><a href="#_9-处理-loading-状态" aria-hidden="true" class="header-anchor">#</a> 9.处理 loading 状态</h2> <p>可以使用dva-loading插件，通过这个插件，我们可以不必一遍遍地写 showLoading 和 hideLoading，当发起请求时，插件会自动设置数据里的 loading 状态为 true 或 false 。然后我们在渲染 components 时绑定并根据这个数据进行渲染。</p> <p>修改src/pages/users/components/Users.js</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span>  <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> list<span class="token punctuation">,</span> total<span class="token punctuation">,</span> page <span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">.</span>users<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      list<span class="token punctuation">,</span>
      total<span class="token punctuation">,</span>
      page<span class="token punctuation">,</span>
      loading<span class="token punctuation">:</span> state<span class="token punctuation">.</span>loading<span class="token punctuation">.</span>models<span class="token punctuation">.</span>users <span class="token comment">//这个loading属性由dva-loading绑定,users为namespace的名字</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Table dataSource<span class="token operator">=</span><span class="token punctuation">{</span>list<span class="token punctuation">}</span> columns<span class="token operator">=</span><span class="token punctuation">{</span>columns<span class="token punctuation">}</span> rowKey<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">record</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span>record<span class="token punctuation">.</span>id<span class="token punctuation">}</span> pagination<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span> loading<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>loading<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Pagination current<span class="token operator">=</span><span class="token punctuation">{</span>current<span class="token punctuation">}</span> defaultCurrent<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">CURRENT_PAGE</span><span class="token punctuation">}</span> total<span class="token operator">=</span><span class="token punctuation">{</span>totalNums<span class="token punctuation">}</span> 
  showTotal<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span> range</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>range<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> of </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>total<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> items`</span></span><span class="token punctuation">}</span>
  defaultPageSize<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">PAGE_SIZE</span><span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;ant-table-pagination&quot;</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChangeHandler<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>                
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_10-处理用户删除"><a href="#_10-处理用户删除" aria-hidden="true" class="header-anchor">#</a> 10. 处理用户删除</h2> <p>根据上面的处理思路，其它操作大概可以分为以下三个部分处理:</p> <ul><li>services</li> <li>models</li> <li>components
这也是以后开发的三个步骤。</li></ul> <p>现在按照这三个步骤处理用户删除：</p> <ul><li><p>service</p> <p>修改service/users.js文件：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//删除 </span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/api/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    method<span class="token punctuation">:</span><span class="token string">'DELETE'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>models</p> <p>修改model/users.js文件:在effects中增加以下代码</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">*</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>payload<span class="token punctuation">:</span>id<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">,</span>select<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>usersService<span class="token punctuation">.</span>remove<span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token operator">=&gt;</span>state<span class="token punctuation">.</span>users<span class="token punctuation">.</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">'fetch'</span><span class="token punctuation">,</span>payload<span class="token punctuation">:</span><span class="token punctuation">{</span>page<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>components</p> <p>修改component/users.js文件，修改deleteHandler方法即可。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">deleteHandler</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`TODO: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> <span class="token string">'users/remove'</span><span class="token punctuation">,</span>
        payload<span class="token punctuation">:</span> id<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul> <h2 id="_11-用户修改"><a href="#_11-用户修改" aria-hidden="true" class="header-anchor">#</a> 11. 用户修改</h2> <ul><li><p>services</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//修改</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span>values</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/api/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    method<span class="token punctuation">:</span> <span class="token string">'PATCH'</span><span class="token punctuation">,</span>
    body<span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>models</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">*</span><span class="token function">patch</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>payload<span class="token punctuation">:</span><span class="token punctuation">{</span>id<span class="token punctuation">,</span>values<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">,</span>select<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>usersService<span class="token punctuation">.</span>patch<span class="token punctuation">,</span>id<span class="token punctuation">,</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>users<span class="token punctuation">.</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">'fetch'</span><span class="token punctuation">,</span>payload<span class="token punctuation">:</span><span class="token punctuation">{</span>page<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>components</p> <p>由于这块的代码量比较大，并且和创建是可以共用的，所有拆成一个独立的文件UserModel.js文件:</p> <p>创建文件components/UserModel.js</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span>  React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Form<span class="token punctuation">,</span>Modal<span class="token punctuation">,</span>Input<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserModel</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
            visible<span class="token punctuation">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function-variable function">onCancelHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
            visible<span class="token punctuation">:</span><span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token function-variable function">onShowHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
            visible<span class="token punctuation">:</span><span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function-variable function">onOkHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> onOk <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">validateFields</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> values</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">onOk</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onCancelHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> formItemLayout <span class="token operator">=</span> <span class="token punctuation">{</span>
        labelCol<span class="token punctuation">:</span> <span class="token punctuation">{</span> span<span class="token punctuation">:</span> <span class="token number">6</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        wrapperCol<span class="token punctuation">:</span> <span class="token punctuation">{</span> span<span class="token punctuation">:</span> <span class="token number">14</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> FormItem <span class="token operator">=</span> Form<span class="token punctuation">.</span>Item<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> email<span class="token punctuation">,</span> website <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>record<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> getFieldDecorator <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>form<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>span onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onShowHandler<span class="token punctuation">}</span><span class="token operator">&gt;</span>
              <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Modal visible<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>visible<span class="token punctuation">}</span> title<span class="token operator">=</span><span class="token string">&quot;User Edit Modal&quot;</span> onCancel<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onCancelHandler<span class="token punctuation">}</span> onOk<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onOkHandler<span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Form<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>FormItem <span class="token punctuation">{</span><span class="token operator">...</span>formItemLayout<span class="token punctuation">}</span> label<span class="token operator">=</span><span class="token string">&quot;Name&quot;</span><span class="token operator">&gt;</span>
                    <span class="token punctuation">{</span>
                        <span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                            initialValue<span class="token punctuation">:</span>name
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Input placeholder<span class="token operator">=</span><span class="token string">&quot;please input Name&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Input<span class="token operator">&gt;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>FormItem<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>FormItem <span class="token punctuation">{</span><span class="token operator">...</span>formItemLayout<span class="token punctuation">}</span> label<span class="token operator">=</span><span class="token string">&quot;Email&quot;</span><span class="token operator">&gt;</span>
                    <span class="token punctuation">{</span>
                        <span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">'email'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                            initialValue<span class="token punctuation">:</span>email
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Input placeholder<span class="token operator">=</span><span class="token string">&quot;please input Email&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Input<span class="token operator">&gt;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>FormItem<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>FormItem <span class="token punctuation">{</span><span class="token operator">...</span>formItemLayout<span class="token punctuation">}</span> label<span class="token operator">=</span><span class="token string">&quot;Website&quot;</span><span class="token operator">&gt;</span>
                    <span class="token punctuation">{</span>
                        <span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">'website'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                            initialValue<span class="token punctuation">:</span>website
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Input placeholder<span class="token operator">=</span><span class="token string">&quot;please input Website&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Input<span class="token operator">&gt;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>FormItem<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Modal<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  
  <span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span>  Form<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>UserModel<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br></div></div><p>修改components/Users.js文件：
主要是修改二处：一是edit按钮处，二是处理方法：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>UserModel record<span class="token operator">=</span><span class="token punctuation">{</span>record<span class="token punctuation">}</span> onOk<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">editHandler</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>record<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>a<span class="token operator">&gt;</span>Edit<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>UserModel<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">editHandler</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span>values</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token punctuation">:</span><span class="token string">'users/patch'</span><span class="token punctuation">,</span>
    payload<span class="token punctuation">:</span><span class="token punctuation">{</span>
      id<span class="token punctuation">,</span>
      values
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul> <h2 id="_12-用户创建"><a href="#_12-用户创建" aria-hidden="true" class="header-anchor">#</a> 12.用户创建</h2> <ul><li><p>services</p> <p>修改services/users.js文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//新增</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">values</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'/api/users'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    body<span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>models</p> <p>修改models/users.js文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>
<span class="token operator">*</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>payload<span class="token punctuation">:</span><span class="token punctuation">{</span>values<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">,</span>select<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>usersService<span class="token punctuation">.</span>create<span class="token punctuation">,</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>users<span class="token punctuation">.</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">'fetch'</span><span class="token punctuation">,</span>payload<span class="token punctuation">:</span><span class="token punctuation">{</span>page<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>components</p> <p>修改components/users.js文件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>UserModel record <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span> onOk<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">createHandler</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">}</span> title<span class="token operator">=</span><span class="token string">&quot;User Create Modal&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>create<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span><span class="token operator">&gt;</span>Create User<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>UserModel<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">createHandler</span><span class="token punctuation">(</span><span class="token parameter">values</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;createHandler&quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token punctuation">:</span><span class="token string">'users/create'</span><span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span><span class="token punctuation">{</span>
        values
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul> <h2 id="_13-最后效果图"><a href="#_13-最后效果图" aria-hidden="true" class="header-anchor">#</a> 13.最后效果图</h2> <p><img src="/blog/assets/img/4003-5.7c3e0c2b.png" alt="Alt 最终效果图"></p> <p>完整代码可访问: <a href="https://github.com/xiaojun90/user-dashboard" target="_blank" rel="noopener noreferrer">user-dashboard<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div id="vcomments"></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">3 个月前</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/frontend/4001.html" class="prev">
          CSS样式重置
        </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.031b747b.js" defer></script><script src="/blog/assets/js/2.48c166e5.js" defer></script><script src="/blog/assets/js/5.67f4c3de.js" defer></script><script src="/blog/assets/js/11.e98dd118.js" defer></script>
  </body>
</html>
